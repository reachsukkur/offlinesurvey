<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Analytics - Offline Survey App</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/analytics.css">
    <script src="js/libs/chart.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1 data-i18n="analytics">üìä Analytics Dashboard</h1>
            <nav>
                <a href="index.html" data-i18n="surveyBuilder">Builder</a>
                <a href="kiosk.html" data-i18n="kioskMode">Kiosk Mode</a>
                <a href="analytics.html" class="active" data-i18n="analytics">Analytics</a>
                <div id="languageToggleContainer"></div>
            </nav>
        </header>

        <main>
            <div class="analytics-controls">
                <div class="control-group">
                    <label for="surveyFilter" data-i18n="selectSurveyToView">Select Survey:</label>
                    <select id="surveyFilter" class="survey-filter">
                        <option value="">-- Select a Survey --</option>
                    </select>
                </div>
                <div class="control-group">
                    <button id="exportCSVBtn" class="btn btn-secondary" disabled>
                        üì• <span data-i18n="exportCSV">Export to CSV</span>
                    </button>
                    <button id="exportJSONBtn" class="btn btn-secondary" disabled>
                        üì• <span data-i18n="exportJSON">Export to JSON</span>
                    </button>
                    <button id="clearResponsesBtn" class="btn btn-danger" disabled>
                        üóëÔ∏è <span data-i18n="clearAllResponses">Clear All Responses</span>
                    </button>
                </div>
            </div>

            <div id="analyticsContent">
                <div class="no-data">
                    <p data-i18n="selectSurveyToView">Please select a survey to view analytics</p>
                </div>
            </div>

            <!-- Analytics will be displayed here -->
            <div id="analyticsDisplay" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 data-i18n="totalResponses">Total Responses</h3>
                        <div class="stat-value" id="totalResponses">0</div>
                    </div>
                    <div class="stat-card">
                        <h3 data-i18n="firstResponse">First Response</h3>
                        <div class="stat-value" id="firstResponse">-</div>
                    </div>
                    <div class="stat-card">
                        <h3 data-i18n="latestResponse">Latest Response</h3>
                        <div class="stat-value" id="latestResponse">-</div>
                    </div>
                    <div class="stat-card">
                        <h3 data-i18n="completionRate">Completion Rate</h3>
                        <div class="stat-value" id="completionRate">100%</div>
                    </div>
                </div>

                <div class="charts-section">
                    <h2 data-i18n="responseCharts">Response Charts</h2>
                    <div id="chartsContainer">
                        <!-- Charts will be dynamically generated here -->
                    </div>
                </div>

                <div class="responses-section">
                    <h2 data-i18n="individualResponses">Individual Responses</h2>
                    <div class="response-filters">
                        <input type="date" id="dateFrom" class="date-filter">
                        <input type="date" id="dateTo" class="date-filter">
                        <button id="filterBtn" class="btn btn-secondary">
                            <span data-i18n="filter">Filter</span>
                        </button>
                        <button id="clearFilterBtn" class="btn btn-secondary">
                            <span data-i18n="clearFilter">Clear Filter</span>
                        </button>
                    </div>
                    <div id="responsesTable">
                        <!-- Responses table will be displayed here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/language.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/export.js"></script>
    <script src="js/analytics.js"></script>
    <script>
        // Initialize language toggle
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('languageToggleContainer');
            container.innerHTML = LanguageManager.createToggleHTML();
            
            const toggle = document.getElementById('languageToggle');
            toggle.addEventListener('change', (e) => {
                const newLang = e.target.checked ? 'ar' : 'en';
                LanguageManager.setLanguage(newLang);
            });
        });
    </script>
</body>
</html>
